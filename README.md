# jenkins python ci/cd

Test repository for Jenkins based CI/CD of python project.


# Quickstart

Include `Jenkinsfile` in your project and connect it to the running Jenkins server.



# Jenkins CI/CD Pipeline with GitHub Webhook Integration for an ML Project

This repository demonstrates a machine learning (ML) pipeline leveraging Support Vector Machines (SVM). It incorporates Jenkins CI/CD automation triggered by GitHub webhooks to streamline testing, building, and deployment processes.

---

## Project Overview

This project focuses on an end-to-end ML workflow for classification tasks using SVM. The repository includes:

- Python scripts for data preprocessing, model training, and evaluation.
- Unit tests for critical components.
- A Jenkins pipeline (`Jenkinsfile`) for CI/CD.

### Key Files

1. **`train_model.py`**: Script for training the SVM model.
2. **`preprocessing.py`**: Data preprocessing functions.
3. **`tests/`**: Directory containing unit test files.
4. **`requirements.txt`**: List of Python dependencies.
5. **`Jenkinsfile`**: CI/CD pipeline configuration.
6. **`unit_tests.xml`**: JUnit XML report generated by `pytest`.

---

## Jenkinsfile Pipeline Stages

1. **Checkout Code**: 
   - Clones the repository from GitHub.
   - Command: `git checkout $branch_name`.

2. **Setup Environment**:
   - Installs Python dependencies using `pip`.
   - Example: 
     ```bash
     python3 -m venv venv
     source venv/bin/activate
     pip install -r requirements.txt
     ```

3. **Run Unit Tests**:
   - Executes `pytest` for all test cases.
   - Command: `pytest --junitxml=unit_tests.xml`.
   - Generates `unit_tests.xml` for test reporting.

4. **Build SVM Model**:
   - Trains the SVM model with sample datasets.
   - Outputs a serialized model (`.pkl` file).

5. **Package and Archive**:
   - Packages model artifacts and logs.
   - Archives artifacts for deployment:
     ```groovy
     archiveArtifacts artifacts: '**/*.pkl'
     ```

6. **Deploy (Optional)**:
   - Deploys the model to a specified environment (e.g., cloud storage or a web service).

---

## Prerequisites

1. **Jenkins Setup**:
   - Install Jenkins and required plugins (e.g., Git, Pipeline, JUnit).
   - Configure Jenkins to expose endpoints using tools like Ngrok for local testing.

2. **GitHub Repository**:
   - Fork or clone this repository.

3. **Python Environment**:
   - Install Python 3.11 or later.
   - Install dependencies with:
     ```bash
     pip install -r requirements.txt
     ```

4. **Credentials**:
   - Generate a Jenkins API token for authentication.
   - Use the API token in webhook configurations.

---

## Configuring GitHub Webhooks

1. Go to your GitHub repository.
2. Navigate to **Settings > Webhooks**.
3. Add a new webhook with the following details:
   - **Payload URL**: 
     ```
     http://<jenkins-url>/job/<job-name>/buildWithParameters?token=<your-token>
     ```
   - **Content type**: `application/json`.
   - **Triggers**: Select "Just the push event."

---

## Setting Up Jenkins

1. **Create a Pipeline Job**:
   - Go to Jenkins Dashboard > New Item > Pipeline.
   - Add the GitHub repository URL under **Source Code Management**.
   - In **Build Triggers**, enable "GitHub hook trigger for GITScm polling."

2. **Pipeline Configuration**:
   - Use the following pipeline script:
     ```groovy
     pipeline {
         agent any
         stages {
             stage('Checkout Code') {
                 steps {
                     git branch: 'main', url: 'https://github.com/<username>/<repo>.git'
                 }
             }
             stage('Setup Environment') {
                 steps {
                     sh 'python3 -m venv venv && source venv/bin/activate && pip install -r requirements.txt'
                 }
             }
             stage('Run Unit Tests') {
                 steps {
                     sh 'pytest --junitxml=unit_tests.xml'
                 }
             }
             stage('Build SVM Model') {
                 steps {
                     sh 'python train_model.py'
                 }
             }
             stage('Package and Archive') {
                 steps {
                     archiveArtifacts artifacts: '**/*.pkl', fingerprint: true
                 }
             }
         }
     }
     ```

3. **Save and Trigger**:
   - Push code changes to trigger the pipeline via GitHub webhook.

---

## Running the Pipeline

- **Manual Trigger**: 
  - Go to Jenkins Job > Build Now.
- **Automatic Trigger**:
  - Push updates to the GitHub repository. The webhook triggers the pipeline.

---

## Troubleshooting

- **403 Error (No valid crumb)**:
   - Configure CSRF protection in Jenkins.
   - Use a crumb token with the API call.

- **401 Error (Unauthorized)**:
   - Include valid Jenkins credentials in the webhook URL:
     ```
     http://username:api-token@<jenkins-url>/job/<job-name>/buildWithParameters
     ```

- **Pipeline Failures**:
   - Check Jenkins logs for details.
   - Verify Python dependencies and script paths.

---

## Future Enhancements

- Add performance metrics tracking for the model.
- Automate deployment to cloud platforms like AWS S3 or Azure.
- Incorporate additional machine learning models.

---

## License

This project is licensed under the MIT License. See the LICENSE file for more details.

---

### Author

**dc**


For more details refer to this blog post:

[Setting Jenkins CI for python application](https://mdyzma.github.io/2017/10/14/python-app-and-jenkins/)

